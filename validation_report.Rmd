---
title: 'Validation report'
output:
  html_document:
     toc: true
     df_print: paged
  pdf_document: default
  word_document: default
params:
  inputFile: config/R Model Inputs.xlsx
  outputDir: log
---

# Validation Results


## Input Data Check:

```{r, results='hide',  message=FALSE, warning=FALSE}
source("ValidateInput.R")
Validate(inputFile = params$inputFile, outputDir = params$outputDir)
```

```{r echo=FALSE, results='asis'}
fr <- paste(params$outputDir, "input_validation_results.png", sep="/")
knitr::include_graphics(normalizePath(fr))

```

-   Please check below csv files in `r params$outputDir` folder for any row based validation issue:


```{r echo=FALSE, comment='', results='asis', warning=FALSE, message=TRUE, paged.print=TRUE}
files <- list.files(path=params$outputDir, pattern = "(info|warning|error).*.csv")

metadata <- read.csv(paste(params$outputDir, "input_validation_results.csv", sep="/"))
for (f in files){
  filename <- normalizePath(paste(params$outputDir, f, sep="/"))
  message(paste0(filename,"\n\n"))
  rule_name <- gsub('^.+?_violation_(.+?).csv', '\\1', f)
  exp <- metadata %>%
    filter(name == rule_name) %>%
    select(expression) %>%
    unique() %>% 
   .$expression
  
  data <- read.csv(paste(params$outputDir, f, sep="/"))
  print(kableExtra::kbl(head(data), caption=exp, format='pipe') 
        %>% kableExtra::kable_styling(bootstrap_options = c("striped", "hover")))
}
```

## Model Requirement Check:

```{r echo=FALSE, comment=''}
cat(readLines(paste(params$outputDir, "model_input_check.log", sep = "/")), sep = '\n')
```
